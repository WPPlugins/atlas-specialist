var AtlasSpecialist=function(){var self=this;this.refs={},this.opts={appUrl:"https://app.atlashelp.ro"},this.utils={ajaxCall:function(url,data,type){return jQuery.ajax({async:!0,dataType:"json",type:type||"POST",data:"object"==typeof data?JSON.stringify(data):data,url:self.opts.appUrl+"/public/call/"+url,contentType:"application/json; charset=utf-8"})},saveToLocalStorage:function(key,data){"undefined"!=typeof localStorage&&localStorage.setItem(key,JSON.stringify(data))},getFromLocalStorage:function(key){if("undefined"!=typeof localStorage){var data=localStorage.getItem(key);return data?JSON.parse(data):{}}return{}}},"0"!==atlasSpecialistOptions.chatEnable&&this.addAtlasSpecialistChat(),this.displaySpecialistCalendar()};AtlasSpecialist.prototype.addAtlasSpecialistChat=function(){var chatContainer,iframeW,iframeH,self=this,isCollapsed=self.utils.getFromLocalStorage("atlas-chat").collapsed||!1;jQuery("body").append('<div id="atlas-specialist-chat" class="'+(isCollapsed?"atlas-chat-collapsed":"")+'">\t\t\t\t\t\t<div class="asc-header">\t\t\t\t\t\t\t<p>'+(atlasSpecialistOptions.chatTitle||"Live Chat")+'</p>\t\t\t\t\t\t\t<button><i class="atlas-collapse-trigger '+(isCollapsed?"atlas-icon-plus-squared":"atlas-icon-minus-squared")+'"></i></button>\t\t\t\t\t\t</div>\t\t\t\t\t\t<iframe src="'+self.opts.appUrl+"/pages/public/private-chat.jsp?profileURL="+(atlasSpecialistOptions.url||"atlas")+"&language="+atlasSpecialistOptions.locale+"&embedded=true&parent="+encodeURIComponent(window.location.origin)+'"></iframe>\t\t\t\t\t</div>'),(chatContainer=jQuery("#atlas-specialist-chat")).hasClass("atlas-chat-collapsed")&&chatContainer.css("bottom","-"+(chatContainer.height()-27)+"px"),chatContainer.find(".asc-header").on("click",function(){jQuery(window).width();chatContainer.hasClass("atlas-chat-collapsed")?(chatContainer.removeClass("atlas-chat-collapsed"),chatContainer.css("bottom",""),chatContainer.find(".atlas-collapse-trigger").removeClass("atlas-icon-plus-squared").addClass("atlas-icon-minus-squared"),self.utils.saveToLocalStorage("atlas-chat",{collapsed:!1})):(chatContainer.addClass("atlas-chat-collapsed"),chatContainer.css("bottom","-"+(chatContainer.height()-27)+"px"),chatContainer.find(".atlas-collapse-trigger").removeClass("atlas-icon-minus-squared").addClass("atlas-icon-plus-squared"),self.utils.saveToLocalStorage("atlas-chat",{collapsed:!0}))}),iframeW=chatContainer.width(),iframeH=chatContainer.height(),window.addEventListener("message",function(event){event.origin===self.opts.appUrl&&event.data&&("expand"===event.data?chatContainer.css({width:iframeW+100,height:iframeH+200}):chatContainer.css({width:iframeW,height:iframeH}))},!1)},AtlasSpecialist.prototype.displaySpecialistCalendar=function(){var self=this,monthNameList=["January","February","March","April","May","June","July","August","September","October","November","December"],now=new Date,calendar=jQuery(".atlas-app-calendar");if(!calendar.length)return!1;self.utils.ajaxCall("getAllForProvider",{data:now.getFullYear()+" "+monthNameList[now.getMonth()],url:atlasSpecialistOptions.url}).done(function(data){function getStartDate(sd){var date=new Date(sd),month=date.getMonth()+1,day=date.getDate();return date.getFullYear()+"-"+(month>9?month:"0"+month)+"-"+(day>9?day:"0"+day)}function constructAppsList(data){var sd,ed,interval,appDate,i,key,appointments=[],appObj={};for(i=0;i<data.obj.length;i++)sd=new Date(data.obj[i].sd),ed=new Date(data.obj[i].ed),appDate=getStartDate(data.obj[i].sd),interval=sd.getHours()+":"+(sd.getMinutes()>9?sd.getMinutes():"0"+sd.getMinutes())+" - "+ed.getHours()+":"+(ed.getMinutes()>9?ed.getMinutes():"0"+ed.getMinutes()),appObj.hasOwnProperty(appDate)?appObj[appDate].title=appObj[appDate].title+" \n"+data.obj[i].title+" "+interval:appObj[appDate]={date:appDate,badge:!0,title:data.obj[i].title+" "+interval,classname:"atlas-appointment"};for(key in appObj)appointments.push(appObj[key]);return appointments}data&&data.obj&&calendar.zabuto_calendar({language:atlasSpecialistOptions.locale,today:!0,data:constructAppsList(data),action_nav:function(a,b){var data=jQuery(this).data(),dateTo=data.to.year+" "+monthNameList[data.to.month-1];self.utils.ajaxCall("getAllForProvider",{data:dateTo,url:atlasSpecialistOptions.url}).done(function(data){calendar.data("jsonData",constructAppsList(data)).trigger("zabutoChangeData")})},action:function(){var hasEvent=jQuery("#"+this.id).data("hasEvent"),url=self.opts.appUrl+"/"+atlasSpecialistOptions.url;hasEvent&&window.open(url,"_blank")}})})},jQuery(function(){new AtlasSpecialist});